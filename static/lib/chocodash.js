// Generated by CoffeeScript 1.6.3
(function() {
  var Observer, Publisher, Signal, _, _module,
    __hasProp = {}.hasOwnProperty;

  _module = typeof window !== "undefined" && window !== null ? window : module;

  _module[_module.exports != null ? "exports" : "Chocodash"] = _ = {};

  _.type = function(o) {
    return Object.prototype.toString.apply(o);
  };

  _.Type = {
    Object: '[object Object]',
    Array: '[object Array]',
    Boolean: '[object Boolean]',
    Number: '[object Number]',
    Date: '[object Date]',
    Function: '[object Function]',
    Math: '[object Math]',
    String: '[object String]',
    Undefined: '[object Undefined]',
    Null: '[object Null]'
  };

  _.prototype = function(options, more) {
    var constructor, created, fn, k, name, prototype, v, value;
    if (more != null) {
      if (options != null) {
        for (k in more) {
          v = more[k];
          options[k] = v;
        }
      } else {
        options = more;
      }
      more = null;
    }
    prototype = (function() {
      var flatten;
      flatten = function() {
        var args;
        args = [];
        if (arguments[0] != null) {
          Array.prototype.push.apply(args, arguments);
        }
        return args;
      };
      return {
        use: function() {
          var o, _i, _len, _ref;
          _ref = flatten.apply(null, arguments);
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            o = _ref[_i];
            o.call(this.prototype);
          }
          return this;
        },
        adopt: function() {
          var o, _i, _len, _ref, _ref1;
          _ref = flatten.apply(null, arguments);
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            o = _ref[_i];
            for (k in o) {
              if (!__hasProp.call(o, k)) continue;
              v = o[k];
              this[k] = v;
            }
            _ref1 = o.prototype;
            for (k in _ref1) {
              if (!__hasProp.call(_ref1, k)) continue;
              v = _ref1[k];
              this.prototype[k] = v;
            }
          }
          return this;
        },
        inherit: function(parent) {
          var child, ctor;
          child = this;
          if (parent != null) {
            for (k in parent) {
              if (!__hasProp.call(parent, k)) continue;
              v = parent[k];
              child[k] = v;
            }
            ctor = function() {
              this.constructor = child;
            };
            ctor.prototype = parent.prototype;
            child.prototype = new ctor();
            child.__super__ = parent.prototype;
          }
          return this;
        }
      };
    })();
    constructor = (options != null ? options.hasOwnProperty('constructor') : void 0) ? options.constructor : null;
    created = constructor != null ? function() {
      constructor.apply(this, arguments);
    } : (options != null ? options.inherit : void 0) != null ? function() {
      Array.prototype.unshift.call(arguments, this);
      _["super"].apply(_, arguments);
    } : function() {};
    if (options != null) {
      for (name in options) {
        value = options[name];
        if (name === 'adopt' || name === 'inherit' || name === 'use') {
          prototype[name].call(created, value);
        } else {
          if (name !== 'constructor') {
            created.prototype[name] = value;
          }
        }
      }
    }
    for (name in prototype) {
      if (!__hasProp.call(prototype, name)) continue;
      fn = prototype[name];
      if (created[name] == null) {
        created[name] = fn;
      }
    }
    return created;
  };

  _["super"] = function(self) {
    var k, name, parent, v, _ref;
    name = null;
    parent = arguments.callee;
    while (((parent = parent.caller) != null) && (name == null)) {
      _ref = self.constructor.prototype;
      for (k in _ref) {
        v = _ref[k];
        if (parent === v) {
          name = k;
          break;
        }
      }
    }
    if (name == null) {
      name = 'constructor';
    }
    return self.constructor.__super__[name].apply(self, Array.prototype.slice.call(arguments, 1));
  };

  _.stringify = function() {
    var doit, newline, object, options, tab, _ref;
    if (arguments.length === 0) {
      return void 0;
    }
    object = arguments[0];
    options = (_ref = arguments[1]) != null ? _ref : {};
    if (options.prettify === true) {
      tab = '    ';
      newline = '\n';
    } else {
      tab = newline = '';
    }
    doit = function(o, level) {
      var indent, k, ni, nit, result, type, v;
      result = [];
      if (level == null) {
        level = 0;
      }
      indent = ((function() {
        var _i, _results;
        _results = [];
        for (_i = 0; 0 <= level ? _i < level : _i > level; 0 <= level ? _i++ : _i--) {
          _results.push(tab);
        }
        return _results;
      })()).join('');
      ni = newline + indent;
      nit = ni + tab;
      type = Object.prototype.toString.apply(o);
      result.push((function() {
        switch (type) {
          case '[object Object]':
            return "{" + nit + (((function() {
              var _results;
              _results = [];
              for (k in o) {
                if (!__hasProp.call(o, k)) continue;
                v = o[k];
                _results.push(k + ':' + doit(v, level + 1));
              }
              return _results;
            })()).join(',' + nit)) + ni + "}";
          case '[object Array]':
            return "function () {" + nit + "var a = []; var o = {" + nit + (((function() {
              var _results;
              _results = [];
              for (k in o) {
                if (!__hasProp.call(o, k)) continue;
                v = o[k];
                _results.push(k + ':' + doit(v, level + 1));
              }
              return _results;
            })()).join(',' + nit)) + "};" + nit + "for (var k in o) {a[k] = o[k];} return a; }()";
          case '[object Boolean]':
            return o;
          case '[object Number]':
            return o;
          case '[object Date]':
            return "new Date(" + (o.valueOf()) + ")";
          case '[object Function]':
            return o.toString();
          case '[object Math]':
            return 'Math';
          case '[object String]':
            return "'" + (o.replace(/\'/g, '\\\'')) + "'";
          case '[object Undefined]':
            return 'void 0';
          case '[object Null]':
            return 'null';
          case '[object Buffer]':
          case '[object SlowBuffer]':
            if (o.length === 16) {
              return _.Uuid.unparse(o);
            } else {
              return o.toString();
            }
        }
      })());
      return result;
    };
    return doit(object).join(', ');
  };

  _.parse = function(str) {
    return (new Function("return " + str))();
  };

  _.serialize = function(self, local, fn) {
    var async, defer, deferred, next;
    if (typeof local === 'function') {
      fn = local;
      local = {};
    }
    if (typeof self === 'function') {
      fn = self;
      self = fn;
      local = {};
    }
    deferred = [];
    async = false;
    defer = function(has_more, fn) {
      if (!fn) {
        fn = has_more;
        has_more = true;
      }
      if (has_more) {
        return deferred.push(fn);
      } else {
        return deferred.push(function() {
          if (async === false) {
            return setTimeout(fn, 0);
          } else {
            return fn();
          }
        });
      }
    };
    fn.call(self, defer, local);
    return deferred.shift().call(self, next = function() {
      var result;
      if (deferred.length) {
        result = deferred.shift().call(self, next);
        if (result === next) {
          return async = true;
        }
      }
    });
  };

  _.parallelize = function(self, fn) {
    var count, dfn, end, join, on_join, push, pushed, _i, _len, _results;
    if (typeof self === 'function') {
      fn = self;
      self = fn;
    }
    pushed = [];
    on_join = null;
    join = function(fn) {
      return on_join = fn;
    };
    count = 0;
    end = function() {
      count += -1;
      if (count === 0) {
        return on_join != null ? on_join.call(self) : void 0;
      }
    };
    push = function(fn) {
      return pushed.push(function() {
        return setTimeout((function() {
          fn.call(self);
          return end();
        }), 0);
      });
    };
    fn.call(self, push, join);
    count = pushed.length;
    _results = [];
    for (_i = 0, _len = pushed.length; _i < _len; _i++) {
      dfn = pushed[_i];
      _results.push(dfn.call(self));
    }
    return _results;
  };

  _.defaults = function(object, defaults) {
    var set;
    set = function(o, d) {
      var k, v;
      for (k in d) {
        if (!__hasProp.call(d, k)) continue;
        v = d[k];
        if (_.type(o[k]) === _.Type.Object && _.type(v) === _.Type.Object) {
          set(o[k], v);
        } else {
          if (o[k] == null) {
            o[k] = v;
          }
        }
      }
      return o;
    };
    return set(object, defaults);
  };

  _.Signal = Signal = _.prototype({
    adopt: {
      dependencyStack: [],
      Defer: _.prototype({
        constructor: function(signal, observerList) {
          this.signal = signal;
          this.observerList = observerList;
          return this.count = 0;
        },
        value: function(fn) {
          var observer, stack, _i, _len, _ref, _results;
          stack = Signal.dependencyStack;
          Signal.dependencyStack = [this.signal];
          this.signal._value = fn();
          this.signal._initialized = true;
          this.signal._idle = true;
          Signal.dependencyStack = stack;
          this.count += -1;
          this.signal.propagate(this, this.observerList);
          _ref = this.signal.observers;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            observer = _ref[_i];
            _results.push(observer.notify(true));
          }
          return _results;
        },
        one: function() {
          return this.count += 1;
        },
        idle: function() {
          return this.count === 0;
        }
      })
    },
    constructor: function(definition) {
      this.definition = definition;
      this._value = null;
      this._initialized = false;
      this._idle = true;
      this.dependencies = [];
      this.dependencyType = "signal";
      this.dependents = [];
      this.observers = [];
      this.dependentTargets = [];
      return this.evaluate(new Signal.Defer(this));
    },
    evaluate: function(defer, observerList) {
      var arrayMethods, deferred, dependency, dependentIndex, methodName, observer, result, type, _fn, _i, _j, _k, _l, _len, _len1, _len2, _len3, _len4, _m, _ref, _ref1, _ref2,
        _this = this;
      this._value = this.definition;
      this._idle = true;
      arrayMethods = ["pop", "push", "reverse", "shift", "sort", "splice", "unshift"];
      switch (type = _.type(this.definition)) {
        case _.Type.Function:
          _ref = this.dependencies;
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            dependency = _ref[_i];
            dependentIndex = dependency.dependents.indexOf(this);
            dependency.dependents.splice(dependentIndex, 1);
          }
          this.dependencies = [];
          Signal.dependencyStack.unshift(this);
          deferred = (function(signal) {
            return function(fn) {
              var prev;
              prev = defer.signal;
              defer.signal = signal;
              defer.value.call(defer, fn);
              return defer.signal = prev;
            };
          })(this);
          result = this.definition(deferred);
          if (result === deferred) {
            this._idle = false;
            defer.one();
            _ref1 = this.observers;
            for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
              observer = _ref1[_j];
              observer.notify(false);
            }
          } else {
            this._value = result;
            this._initialized = true;
            this._idle = true;
          }
          Signal.dependencyStack.shift();
          break;
        case _.Type.Object:
        case _.Type.Array:
          this.set = function(key, value) {
            _this.definition[key] = value;
            return _this.value(_this.definition);
          };
          if (type === _.Type.Array) {
            _fn = function(methodName) {
              return _this[methodName] = function() {
                var output;
                output = _this.definition[methodName].apply(_this.definition, arguments);
                _this.value(_this.definition);
                return output;
              };
            };
            for (_k = 0, _len2 = arrayMethods.length; _k < _len2; _k++) {
              methodName = arrayMethods[_k];
              _fn(methodName);
            }
          }
          break;
        default:
          for (_l = 0, _len3 = arrayMethods.length; _l < _len3; _l++) {
            methodName = arrayMethods[_l];
            delete this[methodName];
          }
          delete this.set;
      }
      if (observerList != null) {
        _ref2 = this.observers;
        for (_m = 0, _len4 = _ref2.length; _m < _len4; _m++) {
          observer = _ref2[_m];
          if ((observerList.indexOf(observer)) < 0) {
            observerList.push(observer);
          }
        }
      }
      if (!((deferred != null) && result === deferred)) {
        return this.propagate(defer, observerList);
      }
    },
    idle: function() {
      return this._idle;
    },
    propagate: function(defer, observerList) {
      var dependent, _i, _len, _ref, _results;
      this.dependentTargets = this.dependents.slice(0);
      _ref = this.dependents.slice(0);
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        dependent = _ref[_i];
        if (this.dependentTargets.indexOf(dependent) >= 0) {
          _results.push(dependent.evaluate(defer, observerList));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    },
    value: function(newDefinition) {
      var defer, dependent, existingDependencyIndex, existingDependentIndex, existingObserveeIndex, existingObserverIndex, observer, observerList, targetDependentIndex, _i, _len;
      if (newDefinition !== void 0) {
        this.definition = newDefinition;
        observerList = [];
        defer = new Signal.Defer(this, observerList);
        this.evaluate(defer, observerList);
        if (defer.idle()) {
          for (_i = 0, _len = observerList.length; _i < _len; _i++) {
            observer = observerList[_i];
            observer.trigger();
          }
        }
        return this._value;
      } else {
        dependent = Signal.dependencyStack[0];
        if ((dependent != null) && dependent.dependencyType === "signal") {
          targetDependentIndex = this.dependentTargets.indexOf(dependent);
          if (targetDependentIndex >= 0) {
            this.dependentTargets.splice(targetDependentIndex, 1);
          }
          existingDependentIndex = this.dependents.indexOf(dependent);
          if (existingDependentIndex < 0) {
            this.dependents.push(dependent);
          }
          existingDependencyIndex = dependent.dependencies.indexOf(this);
          if (existingDependencyIndex < 0) {
            dependent.dependencies.push(this);
          }
        } else if ((dependent != null) && dependent.dependencyType === "observer") {
          existingObserverIndex = this.observers.indexOf(dependent);
          if (existingObserverIndex < 0) {
            this.observers.push(dependent);
          }
          existingObserveeIndex = dependent.observees.indexOf(this);
          if (existingObserveeIndex < 0) {
            dependent.observees.push(this);
          }
        }
        return this._value;
      }
    }
  });

  _.Observer = Observer = _.prototype({
    constructor: function(report) {
      this.observees = [];
      this.dependencyType = "observer";
      return this.observe(report);
    },
    observe: function(report) {
      var observee, observerIndex, _i, _j, _len, _len1, _ref, _ref1;
      this.report = report;
      this._ready = true;
      _ref = this.observees;
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        observee = _ref[_i];
        observerIndex = observee.observers.indexOf(this);
        observee.observers.splice(observerIndex, 1);
      }
      this.observees = [];
      Signal.dependencyStack.unshift(this);
      if (this.report !== null) {
        this.report();
      }
      Signal.dependencyStack.shift();
      this._ready = true;
      _ref1 = this.observees;
      for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {
        observee = _ref1[_j];
        if (!observee.idle()) {
          this._ready = false;
          break;
        }
      }
      return null;
    },
    notify: function(status) {
      var observee, _i, _len, _ref;
      if (status === true) {
        this._ready = true;
        _ref = this.observees;
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          observee = _ref[_i];
          if (!observee.idle()) {
            this._ready = false;
            break;
          }
        }
        if (this._ready) {
          return this.trigger();
        }
      } else {
        return this._ready = false;
      }
    },
    trigger: function() {
      Signal.dependencyStack.unshift(this);
      if (this.report !== null) {
        this.report();
      }
      return Signal.dependencyStack.shift();
    },
    ready: function() {
      return this._ready;
    }
  });

  _.Publisher = Publisher = _.prototype({
    constructor: function() {
      var _this = this;
      this.subscribers = [];
      this.signal = new Signal();
      return this.observer = new Observer(function() {
        var report, value, _i, _len, _ref, _results;
        value = _this.signal.value();
        _ref = _this.subscribers;
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          report = _ref[_i];
          _results.push(report(value));
        }
        return _results;
      });
    },
    notify: function(value) {
      return this.signal.value(value);
    },
    subscribe: function(reporter) {
      return this.subscribers.push(reporter);
    }
  });

  _.Uuid = (function(_module) {
    var BufferClass, crypto, define, i, module, parse, require, unparse, uuid, v1, v4, whatwgRNG, _byteToHex, _clockseq, _hexToByte, _lastMSecs, _lastNSecs, _nodeId, _previousRoot, _rb, _rnds, _rnds8, _rng, _seedBytes;
    require = _module.require, crypto = _module.crypto, define = _module.define, module = _module.module;
    _rng = void 0;
    if (typeof require === "function") {
      try {
        _rb = require("crypto").randomBytes;
        _rng = _rb && function() {
          return _rb(16);
        };
      } catch (_error) {}
    }
    if (!_rng && crypto && crypto.getRandomValues) {
      _rnds8 = new Uint8Array(16);
      _rng = whatwgRNG = function() {
        crypto.getRandomValues(_rnds8);
        return _rnds8;
      };
    }
    if (!_rng) {
      _rnds = new Array(16);
      _rng = function() {
        var i, r;
        i = 0;
        r = void 0;
        while (i < 16) {
          if ((i & 0x03) === 0) {
            r = Math.random() * 0x100000000;
          }
          _rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;
          i++;
        }
        return _rnds;
      };
    }
    BufferClass = (typeof Buffer === "function" ? Buffer : Array);
    _byteToHex = [];
    _hexToByte = {};
    i = 0;
    while (i < 256) {
      _byteToHex[i] = (i + 0x100).toString(16).substr(1);
      _hexToByte[_byteToHex[i]] = i;
      i++;
    }
    parse = function(s, buf, offset) {
      var ii;
      i = (buf && offset) || 0;
      ii = 0;
      buf = buf || [];
      s.toLowerCase().replace(/[0-9a-f]{2}/g, function(oct) {
        if (ii < 16) {
          return buf[i + ii++] = _hexToByte[oct];
        }
      });
      while (ii < 16) {
        buf[i + ii++] = 0;
      }
      return buf;
    };
    unparse = function(buf, offset) {
      var bth;
      i = offset || 0;
      bth = _byteToHex;
      return bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + "-" + bth[buf[i++]] + bth[buf[i++]] + "-" + bth[buf[i++]] + bth[buf[i++]] + "-" + bth[buf[i++]] + bth[buf[i++]] + "-" + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]] + bth[buf[i++]];
    };
    _seedBytes = _rng();
    _nodeId = [_seedBytes[0] | 0x01, _seedBytes[1], _seedBytes[2], _seedBytes[3], _seedBytes[4], _seedBytes[5]];
    _clockseq = (_seedBytes[6] << 8 | _seedBytes[7]) & 0x3fff;
    _lastMSecs = 0;
    _lastNSecs = 0;
    v1 = function(options, buf, offset) {
      var b, clockseq, dt, msecs, n, node, nsecs, tl, tmh;
      i = buf && offset || 0;
      b = buf || [];
      options = options || {};
      clockseq = (options.clockseq != null ? options.clockseq : _clockseq);
      msecs = (options.msecs != null ? options.msecs : new Date().getTime());
      nsecs = (options.nsecs != null ? options.nsecs : _lastNSecs + 1);
      dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs) / 10000;
      if (dt < 0 && (options.clockseq == null)) {
        clockseq = clockseq + 1 & 0x3fff;
      }
      if ((dt < 0 || msecs > _lastMSecs) && (options.nsecs == null)) {
        nsecs = 0;
      }
      if (nsecs >= 10000) {
        throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");
      }
      _lastMSecs = msecs;
      _lastNSecs = nsecs;
      _clockseq = clockseq;
      msecs += 12219292800000;
      tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;
      b[i++] = tl >>> 24 & 0xff;
      b[i++] = tl >>> 16 & 0xff;
      b[i++] = tl >>> 8 & 0xff;
      b[i++] = tl & 0xff;
      tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;
      b[i++] = tmh >>> 8 & 0xff;
      b[i++] = tmh & 0xff;
      b[i++] = tmh >>> 24 & 0xf | 0x10;
      b[i++] = tmh >>> 16 & 0xff;
      b[i++] = clockseq >>> 8 | 0x80;
      b[i++] = clockseq & 0xff;
      node = options.node || _nodeId;
      n = 0;
      while (n < 6) {
        b[i + n] = node[n];
        n++;
      }
      if (buf) {
        return buf;
      } else {
        return unparse(b);
      }
    };
    v4 = function(options, buf, offset) {
      var ii, rnds;
      i = buf && offset || 0;
      if (typeof options === "string") {
        buf = (options === "binary" ? new BufferClass(16) : null);
        options = null;
      }
      options = options || {};
      rnds = options.random || (options.rng || _rng)();
      rnds[6] = (rnds[6] & 0x0f) | 0x40;
      rnds[8] = (rnds[8] & 0x3f) | 0x80;
      if (buf) {
        ii = 0;
        while (ii < 16) {
          buf[i + ii] = rnds[ii];
          ii++;
        }
      }
      return buf || unparse(rnds);
    };
    uuid = v4;
    uuid.v1 = v1;
    uuid.v4 = v4;
    uuid.parse = parse;
    uuid.unparse = unparse;
    uuid.BufferClass = BufferClass;
    if (typeof define === "function" && define.amd) {
      define(function() {
        return uuid;
      });
    } else if (typeof module !== "undefined" && module.exports) {
      module.exports = uuid;
    } else {
      _previousRoot = _module.Uuid;
      uuid.noConflict = function() {
        _module.Uuid = _previousRoot;
        return uuid;
      };
      _module.Uuid = uuid;
    }
    uuid.isUuid = function(value) {
      var parsed, unparsed;
      if ((value != null) && Object.prototype.toString.apply(value === '[object String]' && value.length === 36)) {
        parsed = parse(value);
        unparsed = unparse(parsed);
        return value === unparsed;
      } else if (Buffer.isBuffer(value)) {
        return value.length === 16;
      } else {
        return false;
      }
    };
    uuid["interface"] = function() {
      return uuid();
    };
    return uuid;
  })(_module);

}).call(this);
